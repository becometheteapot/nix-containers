#!@execline@/bin/execlineb -WS0

# SPDX-FileCopyrightText: 2024 Daniel Sampliner <samplinerD@gmail.com>
#
# SPDX-License-Identifier: GLWTPL

# preinit
foreground { fdmove -c 1 2 printf "%-5s : %s\n" BEGIN PREINIT }
if { mkdir -m 0755 /run/s6 }
if { redirfd -r 0 @s6MkFifos@
	forstdin -E fifo
	backtick -E dir { dirname $fifo }
	if { mkdir -p -m 0555 $dir }
	mkfifo -m 0600 $fifo }
foreground { fdmove -c 1 2 printf "%-5s : %s\n" END PREINIT }

# stage0
foreground { fdmove -c 1 2 printf "%-5s : %s\n" BEGIN STAGE0 }
if { getcwd -E cwd redirfd -w 1 @s6RunDir@/workdir printf "%s\n" $cwd }
foreground { fdmove -c 1 2 printf "%-5s : %s\n" END STAGE0 }

exec @s6BaseDir@/bin/init $@
